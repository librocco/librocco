# Internationalization (i18n) Guide

The Python launcher now supports multiple languages with automatic OS language detection.

## Supported Languages

- **English (en)** - Base language
- **German (de)** - Deutsch
- **Italian (it)** - Italiano

## How It Works

The launcher automatically detects your operating system's language and displays the UI in that language. If your OS language is not supported, it falls back to English.

### OS Language Detection

The launcher uses Python's `locale.getdefaultlocale()` to detect your system language:
- **Linux**: Uses `LANG` environment variable (e.g., `de_DE.UTF-8` → German)
- **macOS**: Uses system language preferences
- **Windows**: Uses Windows language settings

## For Developers: Adding New Strings

When adding new user-facing strings to the code:

1. **Wrap strings with the translation function:**
   ```python
   from launcher.i18n import _

   # Simple string
   button_text = _("Click Me")

   # String with placeholders (use {0}, {1}, etc.)
   message = _("Error: {0}").format(error_message)
   ```

2. **Extract new strings:**
   ```bash
   uv run pybabel extract -F babel.cfg -o launcher/locales/launcher.pot .
   ```

3. **Update existing translation catalogs:**
   ```bash
   uv run pybabel update -i launcher/locales/launcher.pot -d launcher/locales
   ```

4. **Translate the new strings** in each `.po` file:
   - `launcher/locales/de/LC_MESSAGES/launcher.po` (German)
   - `launcher/locales/it/LC_MESSAGES/launcher.po` (Italian)

5. **Compile translations:**
   ```bash
   uv run pybabel compile -d launcher/locales -D launcher
   ```

## For Translators: Editing Translations

Translation files are in standard Gettext `.po` format, located at:
- German: `launcher/locales/de/LC_MESSAGES/launcher.po`
- Italian: `launcher/locales/it/LC_MESSAGES/launcher.po`

### Format Example

```po
#: launcher/tray_app.py:71
msgid "Start Caddy"
msgstr "Caddy starten"
```

- `msgid`: Original English text
- `msgstr`: Translated text (edit this)

### After Editing

Compile the translations to binary `.mo` files:
```bash
uv run pybabel compile -d launcher/locales -D launcher
```

## Adding a New Language

To add support for a new language (e.g., French):

1. **Initialize the catalog:**
   ```bash
   uv run pybabel init -i launcher/locales/launcher.pot -d launcher/locales -l fr
   ```

2. **Rename the file:**
   ```bash
   mv launcher/locales/fr/LC_MESSAGES/messages.po launcher/locales/fr/LC_MESSAGES/launcher.po
   ```

3. **Translate all strings** in `launcher/locales/fr/LC_MESSAGES/launcher.po`

4. **Add the language code** to `SUPPORTED_LANGUAGES` in `launcher/i18n.py`:
   ```python
   SUPPORTED_LANGUAGES = ["en", "de", "it", "fr"]
   ```

5. **Compile:**
   ```bash
   uv run pybabel compile -d launcher/locales -D launcher
   ```

## Testing Translations

Run the test script to verify translations:
```bash
uv run python test_i18n.py
```

To test with a specific locale temporarily:
```bash
# Linux/macOS
LANG=de_DE.UTF-8 python main.py
LANG=it_IT.UTF-8 python main.py

# Or set language in code (for testing only)
from launcher.i18n import setup_i18n
setup_i18n("de")  # Force German
```

## Architecture

- **`launcher/i18n.py`**: Core i18n module with locale detection and translation function
- **`launcher/locales/`**: Translation files organized by language
  - `{lang}/LC_MESSAGES/launcher.po`: Editable translation source
  - `{lang}/LC_MESSAGES/launcher.mo`: Compiled binary (auto-generated)
- **`babel.cfg`**: Babel extraction configuration
- **Console output**: NOT translated (intentionally, for debugging)
- **UI strings**: All translated (menus, dialogs, buttons, status messages)

## Best Practices

1. **Keep strings short and clear** - Translations may be longer than English
2. **Use placeholders** for dynamic content: `_("Status: {0}").format(status)`
3. **Don't translate**:
   - Log messages (for debugging)
   - Console output (as per project requirements)
   - Technical terms like "Caddy", "PID", "URL"
4. **Do translate**:
   - All menu items
   - All dialog titles and messages
   - All button labels
   - All status messages
   - All user-visible text

## Translation Coverage

Current translation coverage:
- ✅ System tray menu items and status
- ✅ Error dialogs and messages
- ✅ Log viewer window (title, tabs, buttons)
- ✅ Notification messages
- ❌ Console output (intentionally not translated)
